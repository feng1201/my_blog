# 实验记录

之前已经完成了数据集的再生成，今天实验的目的是进行事件预测的实验并记录数据。但在此之前，我需要先将整理后的 SFT 微调格式数据过一遍，使用脚本筛选出来包含反向冲突的数据。

## 今日todolist:
1. 完成整体实验
2. 完成 tsencoder/合成数据/二阶段 SFT 消融实验

首先进行日期划分为训练集和测试集，再进行数据合成。然后进行合成数据的微调。

### 事件预测的 Prompt

这里我使用的事件预测的 prompt 如下：

```
You are given weekly U.S. gasoline prices (OT):
- Context window (last 3 months, weekly OT):
<ts3m><ts3m/>
- Current month only (weekly dOT):
<tsdot><tsdot/>

Task: Hypothesize up to 5 plausible REAL-TIME events that occurred WITHIN THE CURRENT MONTH ONLY.
Each event must be an AAOD key string: "NAME|ACTION|OBJECT|DIRECTION".
{ "hypotheses": [{"key": "NAME|ACTION|OBJECT|DIRECTION"}] }

Choose each slot from the allowed sets below (do not invent new tokens):
('NAME ∈ {market,eia, opec, opec_plus, eia, united_states}',
 'ACTION ∈ {cut, price_change, raise, report_release, production_raise, forecast_lower, forecast_raise, close}',
 'OBJECT ∈ {crude_oil, gasoline, price, production, natural_gas, inventory}',
 'DIRECTION ∈ {ambiguous, down, up}')

Do not fabricate. Do not include the same AAOD events in the output. Try to fully consider and design different NAMEs and ACTIONs.
```

### 实验结果

不过这次实验效果并不好，召回率为 35%。同时我比较好奇，假如打开思考模式会怎么样。发现开了思考模式 512 token 不够用了，扩展到 2048，结果挂着运行吃饭去了，回来发现还没跑完。……

从结果来看，开启思考模式后召回率跌倒了 17%，相当于对半了。后面继续跑二阶段 SFT 的消融，也就是只使用编码器。实验结果显示召回率仅为 13%。同时我剔除时序编码器，正确率也是仅仅为 13%。看来编码器和二阶段 SFT 需要同时存在才可以 work。仅仅使用真实数据训练显示召回率为 30%。
